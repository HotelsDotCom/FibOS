/*! uiMarker - v1.0.5 - 2015-03-27 */
var uiMarker=function(){var a=function(a){function b(a,b){this.$el=null,this._ID=a,this._selectorsMapping=null,this._globalSelectors=null,this._styles={},this._options={extension:{},reference:"body"},this._init(b)}return b.prototype={initOptions:function(){},initStyles:function(){},initEvents:function(){},createSubElements:function(){},afterInit:function(){},appendTo:function(b){b&&(b instanceof String&&(b=a(b)),this.$el.appendTo(b))},show:function(){this.$el.show()},hide:function(){this.$el.hide()},setOptions:function(){for(var a in arguments)arguments.hasOwnProperty(a)&&this._extendObject(this._options,arguments[a])},setStyles:function(){for(var a in arguments)arguments.hasOwnProperty(a)&&this._extendObject(this._styles,arguments[a])},_init:function(a){this.initOptions(a),this.initStyles(this._options.extension),this._createElement(),this._createStyleTag(),this.initEvents(),this.afterInit()},_createElement:function(){var b=a("#"+this._ID);b.length>0&&(b.remove(),console.log("Container ID already in use and thus has been removed.")),this.$el=a("<div/>").attr("id",this._ID),this.createSubElements()},_createStyleTag:function(){var b=this._ID+"-style";a("#"+b).remove();var c,d,e,f,g,h=a("<style/>").attr("id",b);for(e in this._styles)this._styles.hasOwnProperty(e)&&(f=this._styles[e],d=this._selectorsMapping&&this._selectorsMapping[e],g=this._globalSelectors&&this._globalSelectors[e],c=g?"":"#"+this._ID,"main"!=e&&(c+=" "+(d||"."+e)),h.append(c+" {"+this._styleObjectToString(f)+"}"));a("head").append(h)},_extendObject:function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]&&a[c]instanceof Object&&!(a[c]instanceof Array)?this._extendObject(a[c],b[c]):a[c]=b[c])},_styleObjectToString:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+":"+a[c]+";");return b.join("")}},b}(jQuery),b=function(a,b){function c(a,c){b.call(this,a,c)}function d(a){return null===a?!1:"boolean"==typeof a?a:"function"==typeof a?a():void 0}function e(a){var b,c=d(this._options.checkUseMarker),e=d(this._options.checkUseFont);return c||e?(b=m.call(this,a),c&&f.call(this,a,b),e&&g.call(this,a,b),!0):!1}function f(b,c){var d=this._options.markerData;if(a(b).data(d)===!0)return!0;c||(c=m.call(this,b));for(var e,f,g=p(b),j=a("<div/>").addClass("fibo-markers").on("click",function(b){i(a(b.currentTarget),d)}),k=a("<div/>").addClass("fibo-lines").appendTo(j),l=0;l<g.tot;l++)f=s.call(this,c,-(l*g.lh)),e=t.call(this,c,-(l*g.lh)),k.append(f),j.append(e);h.call(this,b,j,d)}function g(b,c){var d=this._options.fontData;if(a(b).data(d)===!0)return!0;c||(c=m.call(this,b));var e,f,g=p(b),j=a("<div/>").addClass("fibo-fontinfo").on("click",function(b){i(a(b.currentTarget),d)});f=l(b),e=u.call(this,c,f,-g.height),j.append(e),h.call(this,b,j,d)}function h(b,c,d){a(b).data(d,!0),a(c).data("ref",b),this.$el.append(c)}function i(b,c){a(a(b).data("ref")).data(c,!1),a(b).remove()}function j(a){if(o.call(this,a.target)){var b=e.call(this,a.target);return b&&a.preventDefault(),b&&a.stopPropagation(),!b}return!0}function k(b){return a(b.currentTarget).remove(),!1}function l(b){var c=a(b),d=c.css("font-weight"),e=c.css("font-size").replace("px",""),f=c.css("font-family").split(",")[0].replace(/\"|\'/g,""),g=f.split(" ")[0].substr(0,1).toUpperCase(),h=f.split(" ")[1]?f.split(" ")[1].substr(0,1).toUpperCase():f.substr(1,1).toLowerCase(),i=g+h;return[i,d,e]}function m(b){var c=a(b),d=c.width(),e=c.offset().left+parseFloat(c.css("padding-left")),f=q.call(this,c);return f.base+=this._options.markerOffset,f.top-=this._options.markerOffset,{width:d,height:f.base-f.top,offset:{top:f.top,left:e}}}function n(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&a[c]&&b.push(c);return b.join(",")}function o(b){var c=a(b);if(""!==this._options.excluded&&c.closest(this._options.excluded).length>0)return!1;var d=""!==c.html()&&""!==c.text()&&" "!==c.text()&&"&nbsp;"!==c.text();if(d){var e,f=this._options.taglist;for(e in f)if(f.hasOwnProperty(e)&&f[e]&&c.is(e))return!0;if(c.is("div")&&0===c.find("*").length)return!0}return!1}function p(b){var c=parseFloat(a(b).css("line-height")),d=a(b).height(),e=Math.round(d/c);return{tot:e,lh:c,height:c*(e-1)}}function q(b){var c=b.css("font-family"),d=parseFloat(b.css("font-size")),e=a("<img/>").attr("src",this._options.markerLine).css({width:"1px",height:"1px","vertical-align":"baseline"});e.appendTo(b);var f=e.offset().top,g=f-r.call(this,c,d);return e.remove(),{base:f+1,top:g}}function r(b,c){var d=a("<div/>").attr("id","txh").css({"font-family":b,"font-size":"200px",width:"10ex"}),e=a("<div/>").attr("id","tmh").css({"font-family":b,"font-size":"200px",width:"10em"}),f=a("<div/>").attr("id","txt").css({"font-family":b,"font-size":"200px",width:"1ex"}),g=a("<div/>").attr("id","tmt").css({"font-family":b,"font-size":"200px",width:"1em"}),h=a("<div/>").attr("id","tyh").css({"font-family":b,"font-size":"400px",width:"10ex"}),i=a("<div/>").attr("id","tnh").css({"font-family":b,"font-size":"400px",width:"10em"}),j=a("<div/>").attr("id","tyt").css({"font-family":b,"font-size":"400px",width:"1ex"}),k=a("<div/>").attr("id","tnt").css({"font-family":b,"font-size":"400px",width:"1em"}),l=a("<div/>").attr("id","tfs").css({"font-family":b,"font-size":c,width:"100em"}),m=a("<div/>").attr("id","xh_cont").append(d).append(e).append(f).append(g).append(h).append(i).append(j).append(k).append(l);a("body").append(m);{var n=d[0].offsetWidth/e[0].offsetWidth,o=f[0].offsetWidth/g[0].offsetWidth,p=h[0].offsetWidth/i[0].offsetWidth,q=j[0].offsetWidth/k[0].offsetWidth,r=l[0].offsetWidth/100,s=Math.round(p*r);p.toPrecision(3)}m.empty().remove();var t=.005;return(Math.abs(n-p)>t||Math.abs(o-p)>t||Math.abs(q-p)>t)&&alert("inconsistent values: "+n+" "+o+" "+p+" "+q),s}function s(b,c){if(!d(this._options.checkShowLines))return null;var e={top:b.offset.top+(c||0),left:b.offset.left},f={top:e.top,base:e.top+b.height};f.base-=this._options.markerOffset+1,f.top+=this._options.markerOffset;var g=a("<div/>");for(var h in f)f.hasOwnProperty(h)&&a("<div/>").addClass(this._options.linesClass).css({top:f[h],left:b.offset.left,width:b.width}).appendTo(g);return g.children()}function t(b,c){var d={top:b.offset.top+(c||0),left:b.offset.left};return a("<div/>").addClass(this._options.markerClass).width(b.width).height(b.height).offset(d)}function u(b,c,d){var e={top:b.offset.top-45+(d||0),left:b.offset.left+10},f=a("<p/>").addClass("fi1").text(c[0]),g=a("<p/>").addClass("fi2").text(c[1]),h=a("<p/>").addClass("fi3").text(c[2]);return a("<div/>").addClass(this._options.fontClass).append(f,g,h).offset(e)}return c.prototype=Object.create(b.prototype),c.prototype.initOptions=function(a){this.setOptions({markerLine:"",markerOffset:2,checkUseMarker:!0,checkShowLines:!0,checkUseFont:!0,markerClass:"fiboMarker",linesClass:"fiboLine",fontClass:"fiboFontinfo",markerData:"markerHL",fontData:"markerFI",excluded:"",taglist:{p:!0,span:!0,strong:!0,li:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,a:!0,input:!0,select:!0,textfield:!0,label:!0}},a),this._options.excluded=(""===this._options.excluded?"":this._options.excluded+",")+"."+this._options.fontClass},c.prototype.initStyles=function(a){var b=this._options.markerClass,c=this._options.linesClass,d=this._options.fontClass;this._selectorsMapping={marker:"."+b,line:"."+c,fontinfo:"."+d,fontinfo_p:"."+d+" p",fontinfo_p1:"."+d+" p.fi1",fontinfo_p2:"."+d+" p.fi2",fontinfo_p3:"."+d+" p.fi3"},this.setStyles({main:{position:"absolute"},marker:{position:"absolute !important","z-index":"1",background:"#0ff",opacity:"0.5"},line:{position:"absolute !important","z-index":"2",background:"#f00",left:0,"font-size":"1px","line-height":"1px",height:"1px",width:"100%",overflow:"hidden"},fontinfo:{position:"absolute !important","z-index":"3",background:"rgba(34, 34, 34, 0.7)",border:"1px solid #fff",padding:"3px","font-family":"Open Sans",color:"#fff"},fontinfo_p:{margin:"0",cursor:"default","text-algin":"center"},fontinfo_p1:{"font-size":"13px","font-weight":"700","margin-top":"-4px"},fontinfo_p2:{"font-size":"10px","font-weight":"400",margin:"-5px 0"},fontinfo_p3:{"font-size":"14px","font-weight":"600","margin-bottom":"-4px"}},a)},c.prototype.initEvents=function(){var b=this._options.reference,c="."+this._options.markerClass,d=n(this._options.taglist);a(b).off(".markerevent").on("click.markerevent",c,k.bind(this)),a(d).off(".markerevent").on("click.markerevent",j.bind(this)).data(this._options.markerData,null).data(this._options.fontData,null)},c.prototype.addMarkerToElement=function(a){return e.call(this,a)},c.prototype.markEvent=function(a){return j.call(this,a)},c.prototype.unmarkEvent=function(a){return k.call(this,a)},c}(jQuery,a);return b}();