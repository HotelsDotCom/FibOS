/**
 * Created by fdimonte on 13/02/2015.
 *
 * minified with http://jscompress.com/
 *
 */

/******************************
 * UIBaseWidget
 ******************************/
var UIBaseWidget=function(){function t(t,e){this.$el=null,this._ID=t,this._selectorsMapping=null,this._styles={},this._options={extension:{},reference:"body"},this.init(e)}return t.prototype={initOptions:function(t){t&&this.extendObject(this._options,t)},initStyles:function(t){t&&this.extendObject(this._styles,t)},initEvents:function(){},createSubElements:function(){},afterInit:function(){},init:function(t){this.initOptions(t),this.initStyles(this._options.extension),this.createElement(),this.createStyleTag(),this.initEvents(),this.afterInit()},createElement:function(){var t=$("#"+this._ID);t.length>0&&(t.remove(),console.log("Container ID already in use and thus has been removed.")),this.$el=$("<div/>").attr("id",this._ID),this.createSubElements()},createStyleTag:function(){var t=this._ID+"-style";$("#"+t).remove();var e,i,n,s,o=$("<style/>").attr("id",t);for(n in this._styles)this._styles.hasOwnProperty(n)&&(s=this._styles[n],e="#"+this._ID,i=this._selectorsMapping&&this._selectorsMapping[n],"main"!=n&&(e+=" "+(i||"."+n)),o.append(e+" {"+this.styleObjectToString(s)+"}"));$("head").append(o)},extendObject:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]&&t[i]instanceof Object&&!(t[i]instanceof Array)?this.extendObject(t[i],e[i]):t[i]=e[i])},styleObjectToString:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i+":"+t[i]+";");return e.join("")}},t}();

/******************************
 * UIMarkerWidget
 ******************************/
var UIMarkerWidget=function(t){function e(e,i){t.call(this,e,i)}function i(t,e){var i="markerHL";if($(t).data(i)===!0)return!0;e||(e=c(t));var n=$('<div class="'+this._options.markerClass+'"/>').width(e.width).height(e.height).offset(e.offset).click(function(t){s.call(this,$(t.currentTarget),i)}.bind(this));o.call(this,t,n,i)}function n(t,e){var i="markerFI";if($(t).data(i)===!0)return!0;e||(e=c(t));var n=l(t),r=$('<p class="fi1"/>').text(n[0]),a=$('<p class="fi2"/>').text(n[1]),f=$('<p class="fi3"/>').text(n[2]),p=$('<div class="'+this._options.fontClass+'"/>').append(r,a,f).offset({top:e.offset.top-45,left:e.offset.left+10}).click(function(t){console.log(this),s.call(this,$(t.currentTarget),i)}.bind(this));o.call(this,t,p,i)}function o(t,e,i){$(t).data(i,!0),$(e).data("ref",t),this.$el.append(e)}function s(t,e){$($(t).data("ref")).data(e,!1),$(t).remove()}function r(){var t=d.call(this);$(t).off(".prevent").on("click.prevent",function(e){$(e.target).is(t)&&0===$(e.target).closest(this._options.excluded).length&&e.preventDefault()}.bind(this))}function a(){var t=d.call(this);$(t).off(".prevent")}function f(t){g.call(this,t.target)&&this.addTextFontHighlight(t.target)}function p(t){$(t.currentTarget).remove()}function l(t){var e=$(t),i=e.css("font-weight"),n=e.css("font-size").replace("px",""),o=e.css("font-family").split(",")[0].replace(/\"|'/g,""),s=o.split(" ")[0].substr(0,1).toUpperCase(),r=o.split(" ")[1]?o.split(" ")[1].substr(0,1).toUpperCase():o.substr(1,1).toLowerCase(),a=s+r;return[a,i,n]}function c(t){var e=h(t),i=$(t);return{width:i.width(),height:i.height()-(e.t+e.b),offset:{left:i.offset().left+Number(i.css("padding-left").replace("px","")),top:i.offset().top+Number(i.css("padding-top").replace("px",""))+e.t}}}function h(t){var e=$(t),i=!0,n=e.css("font-weight"),o=e.css("font-size").replace("px",""),s=e.css("font-family").split(",")[0].replace(/\"|'/g,""),r={8:u(),9:u(),10:u(),11:u(),12:u(),13:u(),14:u(),15:u(),16:u(),17:u(),18:u(),19:u(),20:u(),21:u(),22:u(),23:u(),24:u(),25:u(),26:u(),27:u(),28:u(),29:u()},a={Arial:r,"Open Sans":r};if(a.Arial[8]=u(0,0),a["Open Sans"][12]=u(1,-1),a["Open Sans"][21]=u(5,1),a["Open Sans"][26]=u(11,5),i){var f=[];f.push('family:"'+s+'" - size:'+o+" - weight:"+n),a[s]||f.push("fontFAMILY not used.. we'll implement it soon!"),a[s]&&(!a[s][o]||0===a[s][o].t&&0===a[s][o].b)&&f.push("fontSIZE not used.. we'll implement it soon!"),f.push("-----------------"),console.log(f.join("\n"))}var p;return p=a[s]?a[s]:r,p=p[o]?p[o]:p[8]}function u(t,e){return{t:t&&0!==t?t:0,b:e&&0!==e?e:0}}function d(){var t=this._options.taglist,e=[];for(var i in t)t.hasOwnProperty(i)&&t[i]&&e.push(i);return e.join(",")}function g(t){var e=$(t);if(""!==this._options.excluded&&e.closest(this._options.excluded).length>0)return!1;var i=""!==e.html()&&""!==e.text()&&" "!==e.text()&&"&nbsp;"!==e.text();if(i){var n,o=this._options.taglist;for(n in o)if(o.hasOwnProperty(n)&&o[n]&&e.is(n))return!0;if(e.is("div")&&0===e.find("*").length)return!0}return!1}return e.prototype=Object.create(t.prototype),e.prototype.initOptions=function(e){this.extendObject(this._options,{checkUseMarker:null,checkUseFont:null,markerClass:"uieMarker",fontClass:"uieFontinfo",excluded:"",taglist:{p:!0,span:!0,strong:!0,li:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,a:!0,input:!0,select:!0,textfield:!0}}),t.prototype.initOptions.call(this,e),this.extendObject(this._options,{excluded:(""===this._options.excluded?"":this._options.excluded+",")+"."+this._options.fontClass})},e.prototype.initStyles=function(e){var i=this._options.markerClass,n=this._options.fontClass;this._selectorsMapping={marker:"."+i,fontinfo:"."+n,fontinfo_p:"."+n+" p",fontinfo_p1:"."+n+" p.fi1",fontinfo_p2:"."+n+" p.fi2",fontinfo_p3:"."+n+" p.fi3"},this.extendObject(this._styles,{main:{position:"absolute"},marker:{position:"absolute !important","z-index":"1",background:"#0ff",opacity:"0.5"},fontinfo:{position:"absolute !important","z-index":"2",background:"rgba(34, 34, 34, 0.7)",border:"1px solid #fff",padding:"3px","font-family":"Open Sans",color:"#fff"},fontinfo_p:{margin:"0",cursor:"default","text-algin":"center"},fontinfo_p1:{"font-size":"13px","font-weight":"700","margin-top":"-4px"},fontinfo_p2:{"font-size":"10px","font-weight":"400",margin:"-5px 0"},fontinfo_p3:{"font-size":"14px","font-weight":"600","margin-bottom":"-4px"}}),t.prototype.initStyles.call(this,e)},e.prototype.initEvents=function(){var t=this._options.reference,e="."+this._options.markerClass;$(t).off(".markerevent").on("click.markerevent",f.bind(this)).on("click.markerevent",e,p.bind(this))},e.prototype.toggleDefaults=function(t){t?r.call(this):a.call(this)},e.prototype.addTextFontHighlight=function(t){var e,o=this._options.checkUseMarker?this._options.checkUseMarker():!0,s=this._options.checkUseFont?this._options.checkUseFont():!0;return o||s?(e=c(t),o&&i.call(this,t,e),s&&n.call(this,t,e),!0):!1},e}(UIBaseWidget);

/******************************
 * UIRulerWidget
 ******************************/
var UIRulerWidget=function(e){function t(t,r){e.call(this,t,r)}function r(){var e,t,r,i,s=this.ruler.clone().addClass("ruler_min"),l=this.ruler.clone().addClass("ruler_med"),o=this.ruler.clone().addClass("ruler_max"),n=Math.floor(this._options.rulerMed/this._options.rulerMin),u=Math.floor(this._options.rulerMax/this._options.rulerMed),d=Math.ceil(_.call(this)/this._options.rulerMax),h=Math.ceil(p.call(this)/this._options.rulerMax);for(e=0;n>e;e++)l.append(s.clone().css(g(e*this._options.rulerMin)));for(t=0;u>t;t++)o.append(l.clone().css(g(t*this._options.rulerMed)));if(this._options.showRulerH){for(r=0;h>r;r++)this.rulers_h.append(o.clone().css(g(r*this._options.rulerMax)).append(this.ruler_lab.clone().text((r+1)*this._options.rulerMax)));this.$el.append(this.rulers_h)}if(this._options.showRulerV){for(i=0;d>i;i++)this.rulers_v.append(o.clone().css(g(i*this._options.rulerMax)).append(this.ruler_lab.clone().text((i+1)*this._options.rulerMax)));this.$el.append(this.rulers_v)}this._options.showMousePos&&0===$("#").length&&this.$el.append(this.mousepos),this.$el.append(this.rulertop),this.$el.append(this.guides)}function i(e){if(this._options.showMousePos){var t=h.call(this,e.pageX,e.pageY),r="x:"+t.relative.left+", y:"+t.relative.top;this.mousepos.offset(t.absolute),this.mousepos.text(r)}if(this.guide_dragging){var i,s=c(this.guide_dragging),l=a.call(this),o=d.call(this,e);return"v"===s&&(i={top:l.top,left:o.coords.x}),"h"===s&&(i={left:l.left,top:o.coords.y}),this.guide_dragging.offset(i),!1}return!0}function s(e){var t=f(e.currentTarget),r=this.guideline.clone().addClass("guide_"+t),s=$(this._options.guidelinesContainer);return s.append(r),this.guide_dragging=r,this.guide_dragged=null,i.call(this,e),!1}function l(e){return this.guide_dragging=$(e.currentTarget),this.guide_dragged=null,i.call(this,e),!1}function o(e){var t=d.call(this,e),r=$(e.target).closest(".rulers_container").length>0,i=e.pageX>t.bounds.x.min&&e.pageX<t.bounds.x.max&&e.pageY>t.bounds.y.min&&e.pageY<t.bounds.y.max;!this.guide_dragging||!r&&i||(this.guide_dragging.remove(),this.guide_dragging=null),this.guide_dragged=this.guide_dragging,this.guide_dragging=null}function n(e){var t=e.shiftKey?10:e.altKey?.5:1;if(this.guide_dragged&&e.keyCode>=37&&e.keyCode<=40){var r={top:this.guide_dragged.position().top+(38===e.keyCode?-t:40===e.keyCode?t:0),left:this.guide_dragged.position().left+(37===e.keyCode?-t:39===e.keyCode?t:0)};return"v"===c(this.guide_dragged)&&this.guide_dragged.css({left:r.left}),"h"===c(this.guide_dragged)&&this.guide_dragged.css({top:r.top}),!1}return!0}function u(){var e=a.call(this).top-$(window).scrollTop()-this._options.rulerWidth,t=a.call(this).left-$(window).scrollLeft()-this._options.rulerWidth;this.$el.css({top:a.call(this).top,left:a.call(this).left});var r=0>=e?{position:"fixed",top:"0",left:a.call(this).left}:{position:"absolute",top:-this._options.rulerWidth,left:0},i=0>=t?{left:-a.call(this).left+$(window).scrollLeft()}:{left:-this._options.rulerWidth};this.rulers_h.css(r),this.rulers_v.css(i);var s={top:r.top,position:r.position};s.left=0>=e?this.rulers_v.offset().left:i.left,this.rulertop.css(s),$(".guide_h").css({width:p.call(this)})}function d(e){var t=a.call(this),r=t.left-this._options.rulerWidth,i=t.top-this._options.rulerWidth,s=p.call(this)+t.left,l=_.call(this)+t.top,o=e.pageX<r?r:e.pageX>s?s:e.pageX,n=e.pageY<i?i:e.pageY>l?l:e.pageY;return{coords:{x:o,y:n},bounds:{x:{min:r,max:s},y:{min:i,max:l}},isInside:o===e.pageX&&n===e.pageY}}function h(e,t){var r={},i=this.mousepos.width()+4,s=10,l=16;return r.absolute={left:e+s,top:t+l},r.absolute.left+i+s>$(window).width()&&(r.absolute.left=e-i-s),e-=$(this._options.reference).offset().left,t-=$(this._options.reference).offset().top,r.relative={left:Math.round(e),top:Math.round(t)},r}function a(){return $(this._options.reference).offset()}function p(){return $(this._options.reference).width()+Number($(this._options.reference).css("padding-left").replace("px",""))+Number($(this._options.reference).css("padding-right").replace("px",""))}function _(){return $(this._options.reference).height()+Number($(this._options.reference).css("padding-top").replace("px",""))+Number($(this._options.reference).css("padding-bottom").replace("px",""))}function g(e){return{left:e+"px",top:e+"px"}}function c(e){return $(e).attr("class").replace(/ruler_guideline|guide_| /g,"")}function f(e){return $(e).attr("class").replace(/rulers_|container| /g,"")}return t.prototype=Object.create(e.prototype),t.prototype.initOptions=function(t){this.extendObject(this._options,{guidelinesContainer:"#ruler_guides",showMousePos:!0,showRulerV:!0,showRulerH:!0,rulerWidth:20,rulerUnit:5,rulerStepMin:2,rulerStepMed:5}),e.prototype.initOptions.call(this,t);var r=this._options;r.rulerMin||(r.rulerMin=r.rulerUnit),r.rulerMed||(r.rulerMed=r.rulerMin*r.rulerStepMin),r.rulerMax||(r.rulerMax=r.rulerMed*r.rulerStepMed)},t.prototype.initStyles=function(t){var r=this._options.rulerWidth,i=r/2,s=i/2;this._selectorsMapping={rulers_top:".ruler_origin",rulers_cont:".rulers_container",ruler_min:".ruler.ruler_min",ruler_med:".ruler.ruler_med",ruler_max:".ruler.ruler_max",ruler_label:".ruler .ruler_label",ruler_labelv:".rulers_v .ruler_label",ruler_labelh:".rulers_h .ruler_label",ruler_v:".rulers_v .ruler",ruler_h:".rulers_h .ruler",guide_v:".ruler_guideline.guide_v",guide_h:".ruler_guideline.guide_h",guideline:".ruler_guideline",mousepos:".ruler_mousepos",rulerv_min:".rulers_v .ruler_min",rulerv_med:".rulers_v .ruler_med",rulerv_max:".rulers_v .ruler_max",rulerh_min:".rulers_h .ruler_min",rulerh_med:".rulers_h .ruler_med",rulerh_max:".rulers_h .ruler_max"},this.extendObject(this._styles,{main:{position:"absolute",top:a.call(this).top+"px",left:a.call(this).left+"px"},rulers_cont:{position:"absolute",overflow:"hidden",background:"rgba(255,255,255,.8)"},rulers_v:{width:this._options.rulerWidth+"px",height:_.call(this)+"px",top:"0",left:"-"+this._options.rulerWidth+"px"},rulers_h:{height:this._options.rulerWidth+"px",width:p.call(this)+"px",left:"0",top:"-"+this._options.rulerWidth+"px"},ruler:{"z-index":"1",position:"absolute",border:"0 solid #000"},ruler_v:{"border-bottom-width":"1px",left:"0 !important"},ruler_h:{"border-right-width":"1px",top:"0 !important"},ruler_top:{"z-index":"2",position:"absolute",width:this._options.rulerWidth+"px",height:this._options.rulerWidth+"px",top:"-"+this._options.rulerWidth+"px",left:"-"+this._options.rulerWidth+"px",background:"#fff","border-right":"1px solid #000000","border-bottom":"1px solid #000000"},ruler_min:{width:this._options.rulerMin-1+"px",height:this._options.rulerMin-1+"px"},ruler_med:{width:this._options.rulerMed-1+"px",height:this._options.rulerMed-1+"px"},ruler_max:{width:this._options.rulerMax-1+"px",height:this._options.rulerMax-1+"px"},ruler_label:{position:"absolute","font-family":"helvetica","font-size":"8px",cursor:"default"},ruler_labelh:{bottom:"0px",right:"1px"},ruler_labelv:{bottom:"2px",right:"0px",width:"10px",transform:"rotate(-90deg)"},mousepos:{"z-index":"3",position:"absolute",width:"auto",height:"auto",background:"rgba(200,200,200,.8)",border:"1px solid #fff","font-size":"12px",padding:"1px 5px 3px","white-space":"nowrap"},guideline:{position:"absolute",background:"#0f0",width:"1px",height:"1px"},guide_v:{height:_.call(this)+"px",cursor:"ew-resize"},guide_h:{width:p.call(this)+"px",cursor:"ns-resize"}}),this.extendObject(this._styles,{ruler_labelv:{"-webkit-transform":"rotate(-90deg)","-moz-transform":"rotate(-90deg)","-ms-transform":"rotate(-90deg)","-o-transform":"rotate(-90deg)",filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)"}}),e.prototype.initStyles.call(this,t),this.extendObject(this._styles,{rulerv_min:{width:s+"px !important"},rulerv_med:{width:i+"px !important"},rulerv_max:{width:r+"px !important"},rulerh_min:{height:s+"px !important"},rulerh_med:{height:i+"px !important"},rulerh_max:{height:r+"px !important"}})},t.prototype.createSubElements=function(){this.$el.addClass("rulers"),this.rulers_v=$("<div/>").addClass("rulers_container").addClass("rulers_v"),this.rulers_h=$("<div/>").addClass("rulers_container").addClass("rulers_h"),this.ruler=$("<div/>").addClass("ruler"),this.ruler_lab=$("<div/>").addClass("ruler_label"),this.rulertop=$("<div/>").addClass("ruler_origin"),this.mousepos=$("<div/>").addClass("ruler_mousepos"),this.guideline=$("<div/>").addClass("ruler_guideline"),this.guides=$("<div/>").attr("id","ruler_guides"),r.call(this)},t.prototype.initEvents=function(){$(this.$el).off(".guidesevent").on("mousedown.guidesevent",".rulers_container",s.bind(this)).on("mousedown.guidesevent",".ruler_guideline",l.bind(this)),$("body").off(".guidesevent").on("mousemove.guidesevent",i.bind(this)).on("mouseup.guidesevent",o.bind(this)).on("keydown.guidesevent",n.bind(this)),$(window).off(".rulersevent").on("scroll.rulersevent resize.rulersevent",u.bind(this))},t.prototype.afterInit=function(){u.call(this)},t}(UIBaseWidget);

/******************************
 * UISliderWidget
 ******************************/
var UISliderWidget=function(t){function i(i,e){this.sliding=!1,this.mousezero=0,t.call(this,i,e)}function e(t){var i=Math.floor(10*a.call(this,t))/10;return this.slider_output.text(i),this._options.callback&&this._options.callback(t,i),i}function s(t){return $(t.target).is(this.slider_output)?!0:(this.slider_handler.css("left",r.call(this,t,-(this.slider_handler.width()/2))),l.call(this,t),!1)}function l(t){return this.mousezero=this.slider_handler.position().left-h.call(this,t.pageX),this.sliding=!0,o.call(this,t),!1}function n(){return this.sliding=!1,!1}function o(t){return this.sliding&&this.setSliderPerc(r.call(this,t)/u.call(this)),!1}function a(t){var i=this._options.minValue,e=this._options.maxValue,s=this._options.stepValue;return Math.round((i+t*(e-i))/s)*s}function r(t,i){i&&(this.mousezero=i);var e,s=u.call(this);e=h.call(this,t.pageX)+this.mousezero,e=0>e?0:e>s?s:e;var l=this._options.stepValue/(this._options.maxValue-this._options.minValue)*s;return e=Math.floor((e+l/2)/l)*l}function h(t){return t-this.$el.offset().left}function u(){return this.$el.width()-this.slider_handler.width()}return i.prototype=Object.create(t.prototype),i.prototype.initOptions=function(i){this.extendObject(this._options,{minValue:0,maxValue:100,initialValue:100,stepValue:1,callback:null}),t.prototype.initOptions.call(this,i);var e=this._options;e.maxValue<=e.minValue&&(e.maxValue=e.minValue+e.stepValue),e.initialValue<=e.minValue&&(e.initialValue=e.minValue),e.initialValue>=e.maxValue&&(e.initialValue=e.maxValue)},i.prototype.initStyles=function(i){this.extendObject(this._styles,{main:{position:"relative",width:"100px",height:"20px",background:"rgba(100,100,100,.4)"},slider_bar:{position:"absolute",width:"100%",height:"3px",background:"rgb(200,200,200)",top:"9px"},slider_handler:{position:"absolute",width:"10px",height:"20px",background:"rgb(100,100,100)",top:"0",left:"0"},slider_output:{position:"absolute",width:"34px",height:"20px",background:"#fff",top:"0",right:"-34px","text-align":"center","font-size":"12px","line-height":"20px",cursor:"default"}}),t.prototype.initStyles.call(this,i)},i.prototype.createSubElements=function(){this.$el.addClass("slider"),this.slider_bar=$("<div/>").addClass("slider_bar"),this.slider_handler=$("<div/>").addClass("slider_handler"),this.slider_output=$("<div/>").addClass("slider_output"),this.$el.append(this.slider_bar).append(this.slider_handler).append(this.slider_output)},i.prototype.initEvents=function(){var t=".slider_"+this._ID;this.$el.off(t).on("mousedown"+t,s.bind(this)).on("mousedown"+t,".slider_handler",l.bind(this)),$("body").off(t).on("mousemove"+t,o.bind(this)).on("mouseup"+t,n.bind(this))},i.prototype.afterInit=function(){this.setSliderVal(this._options.initialValue)},i.prototype.setSliderVal=function(t){var i=(t-this._options.minValue)/(this._options.maxValue-this._options.minValue);this.setSliderPerc(i)},i.prototype.setSliderPerc=function(t){var i=t*u.call(this);this.slider_handler.css("left",i),e.call(this,t)},i.prototype.getSliderVal=function(){return e.call(this,this.getSliderPerc())},i.prototype.getSliderPerc=function(){var t=this.slider_handler.css("left").replace("px","");return t/u.call(this)},i}(UIBaseWidget);

/******************************
 * UISpacerWidget
 ******************************/
var UISpacerWidget=function(t){function s(s,e){this.defaultGroupName="spacerGroup_",this.lastUsedGroup=this.defaultGroupName+"0",this.spacersGroups=g(),this.mousezero=null,this.dragging=null,this.dragged=null,t.call(this,s,e),this.spacerObjects=C.call(this)}function e(t,s,e){return i.call(this,t,s,e)}function o(t){return t&&this.spacersGroups.groups[t]?($("#"+t).remove(),delete this.spacersGroups.groups[t],!0):!1}function r(){return this.$el.empty(),this.spacersGroups=g(),!0}function i(t,s,e){t||(t=this.lastUsedGroup);var o=$("#"+t);return 0===o.length&&(o=$('<div id="'+t+'" class="spacers_group"/>'),s||this.$el.append(o),!e&&this._options.groupCallback&&this._options.groupCallback(t)),this.lastUsedGroup=t,o}function p(){var t,s={};$("#"+id+" ."+this._options.spacerClass).each(function(e,o){t=$(o).parent().attr("id"),t===id&&(t="spacerGroupDefault"),s[t]||(s[t]=[]),s[t].push([parseInt(N.call(this,o)),Number($(o).css("top").replace("px","")),Number($(o).css("left").replace("px",""))])}.bind(this)),this.spacersGroups.groups=s}function a(){return p.call(this),JSON.stringify(this.spacersGroups.groups)}function n(t,s,e){var o,r=JSON.parse(t);for(var i in r)r.hasOwnProperty(i)&&(s?(delete this.spacersGroups.groups[i],o=r[i]):(o=this.spacersGroups.groups[i],o||(o=[]),o.push.apply(o,r[i])),this.spacersGroups.groups[i]=o);return l.call(this,e)}function l(t){var s,o,r,i,p,a=[];for(var n in this.spacersGroups.groups)if(this.spacersGroups.groups.hasOwnProperty(n)){i=[],o=this.spacersGroups.groups[n],$("#"+n).remove();for(var l=0;l<o.length;l++)s="f_"+("000"+o[l][0]).substr(-3),r=this.spacerObjects[s].clone(),r.css("top",o[l][1]),r.css("left",o[l][2]),i.push(r.prop("outerHTML"));this._options.grouping?(p=e.call(this,n,!0,!0),p.html(i.join("")),t&&p.hide(),a.push(p.prop("outerHTML"))):a.push(i.join(""))}return a.join("")}function c(t,s,e){var o=n.call(this,t,s,e);this.$el.html(o)}function u(){var t,s,e,o="65",r=this._options.spacerMin-1,i=O.call(this,r),p=[],a=this._options.spacerColors,n=this._options.spacerSymbols,l=a.length,c=n.length,u=r,h=0;u>=l&&(u-=Math.floor(u/l)*l),p.after={position:"absolute",left:"0",color:"#fff","-khtml-opacity":"."+o,"-moz-opacity":"."+o,"-ms-filter":'"alpha(opacity='+o+')"',filter:"alpha(opacity="+o+")",opacity:"."+o};for(var f in i)i.hasOwnProperty(f)&&(s=i[f],t=k.call(this,s),e=("000"+s).substr(-3),p[this._options.spacerClass+".fs_"+e]={width:i[f]+"px",height:i[f]+"px",background:a[u]},t>=l&&(p[this._options.spacerClass+".fs_"+e+":after"]={content:'"'+n[h].s+'"',"font-size":Number(s*n[h].f)+"px","line-height":Number(s*n[h].l)+"px"},(t+1)%l===0&&++h>=c&&(h=c-1)),++u>=l&&(u=0));return p}function h(t){var s=Math.round(t%1*100)/100,e=.25>s?0:s>.75?1:.5;return Math.floor(t)+e}function f(t){var s={top:h(Number(t.css("top").replace("px",""))),left:h(Number(t.css("left").replace("px","")))};t.css(s)}function g(){return{groups:{},totalGroups:function(){var t=0;for(var s in this.groups)this.groups.hasOwnProperty(s)&&t++;return t}}}function d(t){var s=t.shiftKey?10:t.altKey?.5:1;return this.dragged&&t.keyCode>=37&&t.keyCode<=40?(this.dragged.offset({top:this.dragged.offset().top+(38===t.keyCode?-s:40===t.keyCode?s:0),left:this.dragged.offset().left+(37===t.keyCode?-s:39===t.keyCode?s:0)}),this._options.moveCallback&&this._options.moveCallback(this.dragged),!1):!0}function b(t){switch(t.type){case"mousedown":m.call(this,t);case"mousemove":_.call(this,t);break;case"mouseup":G.call(this,t)}}function v(){this.$el.css(x.call(this))}function m(t){var s=$(t.target);return this.mousezero={top:s.position().top-t.pageY+x.call(this).top,left:s.position().left-t.pageX+x.call(this).left},y.call(this,s),!1}function y(t){var s=t.parent();s.append(t),this.dragged=null,this.dragging=t}function _(t){return this.dragging?(this.dragging.offset({top:Number(t.pageY+this.mousezero.top),left:Number(t.pageX+this.mousezero.left)}),f(this.dragging),!1):!0}function G(){return this.dragged=this.dragging,this.dragged?(this.dragged.focus(),void(this.dragging&&(this.dragging=null,this._options.moveCallback&&this._options.moveCallback(this.dragged)))):!0}function C(){for(var t,s={},e=this._options.spacerMin-1;e<this._options.spacersList.length;e++)t=("00"+this._options.spacersList[e]).substr(-3),s["f_"+t]=$('<div class="'+this._options.spacerClass+" fs_"+t+'" tabindex=""/>');return s}function N(t){return $(t).attr("class").replace(this._options.spacerMatch,"")}function w(t,s){for(var e=1,o=1,r=0,i=[],p=1;s>=p;p++)e+=r,r=o,o=e,i.push(e);return 0>=t&&(t=1),i.splice(t-1,s-t+1)}function k(t){var s=this._options.spacersList;for(var e in s)if(s.hasOwnProperty(e)&&s[e]===t)return Number(e);return-1}function O(t,s){(!t||0>t)&&(t=0),(!s||s>this._options.spacersList.length-1)&&(s=this._options.spacersList.length-1);for(var e=[],o=t;s>=o;o++)e.push(this._options.spacersList[o]);return e}function x(){return $(this._options.reference).offset()}return s.prototype=Object.create(t.prototype),s.prototype.initOptions=function(s){this.extendObject(this._options,{localStorage:"fibonacciGroups",spacerClass:"fibospacer",spacerMatch:/fibospacer|fs|_| /g,grouping:!0,moveCallback:null,groupCallback:null,spacersList:w(1,12),spacerMin:3,spacerSymbols:[{s:"•",f:2.8,l:1},{s:"★",f:1,l:1.09}],spacerColors:["#0071bc","#ed1e79","#8cc63f","#fbb03b"]}),t.prototype.initOptions.call(this,s)},s.prototype.initStyles=function(s){var e="0 0 5px 2px #222222 inset";this._selectorsMapping={spacer:"."+this._options.spacerClass,shadow:"."+this._options.spacerClass+":focus",after:"."+this._options.spacerClass+":after"},this.extendObject(this._styles,{main:{position:"absolute",top:x.call(this).top+"px",left:x.call(this).left+"px",width:"0",height:"0",overflow:"visible"},spacer:{position:"absolute",display:"block",cursor:"pointer",overflow:"hidden","font-family":"Arial",outline:"0"},shadow:{"-webkit-box-shadow":e,"-moz-box-shadow":e,"box-shadow":e}}),this.extendObject(this._styles,u.call(this)),t.prototype.initStyles.call(this,s)},s.prototype.initEvents=function(){this.$el.off(".spacerevent").on("mousedown.spacerevent","."+this._options.spacerClass,b.bind(this)),$("body").off(".spacerevent").on("mousemove.spacerevent",b.bind(this)).on("mouseup.spacerevent",b.bind(this)).on("keydown.spacerevent",d.bind(this)),$(window).off(".spacerevent").on("scroll.spacerevent resize.spacerevent",v.bind(this))},s.prototype.renameGroup=function(t,s){if(!t||!s)return!1;if(t===s)return!1;if($("#"+s).length>0)return!1;var r=this.spacersGroups.groups[t];if(!r)return!1;this.spacersGroups.groups[s]=r;var i=e.call(this,s);return i.html($("#"+t).html()),o.call(this,t),!0},s.prototype.offsetGroup=function(t){var s,e,o=this.spacersGroups.groups[this.lastUsedGroup],r=$("#"+this.lastUsedGroup).find("."+this._options.spacerClass);r.each(function(r){var i=$(this);s=Number(o[r][1]),e=Number(o[r][2]),i.css("top",s+Number(t.top)),i.css("left",e+Number(t.left))})},s.prototype.saveOffsetGroup=function(t){var s,e=this.spacersGroups.groups[this.lastUsedGroup];for(s in e)e.hasOwnProperty(s)&&(e[s][1]=Number(e[s][1])+Number(t.top),e[s][2]=Number(e[s][2])+Number(t.left));this.spacersGroups.groups[this.lastUsedGroup]=e},s.prototype.offsetCustomGroup=function(t,s){for(var e=0;e<this.spacerslist.length;e++){var o=$(this.spacerslist[e]),r=o.offset(),i={left:r.left+Number(s.left),top:r.top+Number(s.top)};o.offset(i)}},s.prototype.addNewSpacer=function(t,s){if(-1==k.call(this,spacernum))return console.log("WARNING: addSpacer called with unsupported spacer"),null;s||(s=this.lastUsedGroup);var o=("000"+t).substr(-3),r=this.spacerObjects["f_"+o].clone(),i=this._options.grouping?e.call(this,s):this.$el;return r&&i.append(r),r},s.prototype.jsonToString=function(t,s){s||(s="; ");var e=JSON.parse(t),o=0,r=[];for(var i in e)e.hasOwnProperty(i)&&(o++,r.push("  group name: "+i),r.push("    spacers count: "+e[i].length));return r.unshift("groups count: "+o),r.join(s)},s.prototype.setLocalStorage=function(){return localStorage.setItem(this._options.localStorage,a.call(this)),!0},s.prototype.getLocalStorage=function(t){r.call(this);var s=localStorage.getItem(this._options.localStorage);return s&&c.call(this,s,!0,t),s},s.prototype.loadSpacersFromJson=function(t,s){return t&&c.call(this,t,!0,s),t},s}(UIBaseWidget);

/******************************
 * UISpriterWidget
 ******************************/
var UISpriterWidget=function(t){function i(i,s){this.spritesInfo={},this.spritesLoaded=0,this.spritesTotal=0,t.call(this,i,s)}function s(t,i){var s=$(this._options.reference),o=s.find("*");return console.log("calculating... (please, wait until done!)"),o.each(function(t,i){var s=$(i),o=s.css("background-image"),e=""===this._options.domain;if(!e&&o.indexOf(this._options.domain)>-1&&(e=!0),e&&"url"!==o.substr(0,3)&&(e=!1),e){var n=s.css("background-position"),r=n.split(" "),a=-1*p(r[0]),l=-1*p(r[1]),c=p(s.css("padding-left"))+p(s.css("padding-right")),h=p(s.css("padding-top"))+p(s.css("padding-bottom")),d={l:a,t:l},u={w:c+s.width(),h:h+s.height()};o&&"none"!==o&&(this.spritesInfo[o]||(this.spritesInfo[o]=[]),this.spritesInfo[o].push({pos:d,size:u}))}}.bind(this)),console.log("DONE!"),this.spritesTotal=r.call(this),t?(t(this.spritesInfo,i),!0):this.spritesInfo}function o(t){var i,s,o,e;for(var r in t)if(t.hasOwnProperty(r)){e=this.filenameFromCss(r,!0),s=n(t[r]),i=this.spriteImage(r),o=$('<div id="'+e+'" class="obscurers_container"/>'),o.append(i);for(var p in s)o.append(s[p]);this.$el.append(o)}}function e(t){var i="top:"+t.pos.t+"px; left:"+t.pos.l+"px; width:"+t.size.w+"px; height:"+t.size.h+"px;";return $("<div/>").addClass("sprite_obscurer").attr("style",i)}function n(t){var i,s,o=[];for(var n in t)t.hasOwnProperty(n)&&(i=t[n],s=e(i),o.push(s));return o}function r(){var t,i=0;for(t in this.spritesInfo)this.spritesInfo.hasOwnProperty(t)&&i++;return i}function p(t){return Number(t.replace(/px|%/g,""))}function a(t){return t.replace(/url\(|\"|\)/g,"")}function l(t){var i=t.lastIndexOf("/");return t.substr(i+1)}return i.prototype=Object.create(t.prototype),i.prototype.initOptions=function(i){this.extendObject(this._options,{visible:!0,opacity:"0.3",color:"#f00",border:"#0f0",image:"",domain:"",callback:null}),t.prototype.initOptions.call(this,i)},i.prototype.initStyles=function(i){this.extendObject(this._styles,{main:{position:"relative",display:this._options.visible?"block":"none"},obscurers_container:{position:"relative",display:"block",top:"0",left:"0","text-align":"left",border:"1px solid "+this._options.border,visibility:"hidden"},sprite_obscurer:{position:"absolute",display:"block",background:this._options.color,opacity:this._options.opacity}}),this._options.image&&""!==this._options.image&&(this._styles.obscurers_container.background='url("'+this._options.image+'") repeat scroll 0 0 transparent'),t.prototype.initStyles.call(this,i)},i.prototype.filenameFromCss=function(t,i){var s=l(a(t));return i?s.replace(/.png|.jpg|.jpeg|.gif/g,""):s},i.prototype.analyze=function(){s.call(this,o.bind(this))},i}(UIBaseWidget);

/******************************
 * Testing Methods
 ******************************/

var test = {

    uiSpriter: function(){
        var sw = new UISpriterWidget('TEST');
        $('body').append(sw.$el);
        sw.getCSSImages(sw.imagesAnalyzed.bind(sw));
    },

    uiSlider: function(){
        function slider_callback_a(perc,value) {
            console.log("SLIDER A : "+value+" ("+Math.round(perc*100)+"%)");
        }
        function slider_callback_b(perc,value) {
            console.log("SLIDER B : "+value+" ("+Math.round(perc*100)+"%)");
        }
        var slider_opt_a = {
            callback:     slider_callback_a,
            minValue:     180,
            maxValue:     360,
            initialValue: 270,
            stepValue:    5
        };
        var slider_opt_b = {
            callback:     slider_callback_b,
            extension:    {main:{width:'1000px'},slider_handler:{width:'30px',background:'rgba(200,0,0,0.6)'}},
            minValue:     100,
            maxValue:     3000,
            initialValue: 1500,
            stepValue:    10
        };

        var slider_a = new UISliderWidget('SliderA',slider_opt_a);
        $('body').append(slider_a.$el);

        var slider_b = new UISliderWidget('SliderB',slider_opt_b);
        $('body').append(slider_b.$el);
    },

    uiRuler: function(){
        var myExtension = {
            main       : {'z-index':'9999'},
            ruler      : {border:'0 solid #f00'},
            mousepos   : {background:'#cc0'},
            guideline  : {background:'#00f'}
        };
        var myOptions = {
            extension    : myExtension,
            showMousePos : true,
            showRulerV   : false,
            showRulerH   : true,
            rulerWidth   : 40,
            rulerUnit    : 10,
            rulerStepMin : 10,
            rulerStepMed : 10
        };

        var myRuler = new UIRulerWidget('myRuler',myOptions);
        $('body').append(myRuler.$el);
    },

    uiMarker: function(){
        function myCallbackMarker(){
            return false;
        }
        function myCallbackFont(){
            return true;
        }
        var myExtension = {
            main:{'z-index':'9999',top:'0'},
            marker:{'background':'#0f0',opacity:'0.6',top:'0'}
        };
        var myOptions = {
            extension      : myExtension,
            checkUseMarker : myCallbackMarker,
            checkUseFont   : myCallbackFont,
            markerClass    : 'textHighlight',
            taglist        : {a:false,h4:false,h5:false,h6:false}
        };

        var myMarker = new UIMarkerWidget('myMarker', myOptions);
        $('body').append(myMarker.$el);
        myMarker.initEvents();
        myMarker.toggleDefaults(true);
    },

    uiSpacer: function(){
        var myOptions = {
            extension     : { main:{'z-index':'1000'} },
            spacerMin     : 1,
            spacersList   : [1,5,10,15,20,25,30,35,40,45,50,55,60,65]
        };
        var myspacer = new UISpacerWidget('fibo_container',myOptions);
        $('body').append(myspacer.$el);
        myspacer.addNewSpacer(20);
    }

};

//test.uiMarker();
//test.uiRuler();
//test.uiSlider();
//test.uiSpacer();
//test.uiSpriter();
